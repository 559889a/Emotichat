# EmotiChat 未实现功能清单

> 最后更新：2025-11-25
> 剩余功能：约 30%

---

## 高优先级

### 1. 实时变量系统（浏览器权限）

**需求描述**：
- `{{time}}` - 实时获取年月日时分（需精确到分钟）
- `{{location}}` - 实时获取省市（需要地理位置权限）
- `{{device_info}}` - 实时获取设备类型

**当前状态**: 占位符已实现，但未调用真实的浏览器 API

**实现思路**：
1. 使用 `navigator.geolocation` 获取位置
2. 使用 `navigator.userAgent` 解析设备信息
3. 前端实时获取时间

---

### 2. 特殊字段渲染

**需求描述**：
用户可自定义以下内容的渲染方式：
- 引号包裹 `"这是内容"` → 特殊背景色/高亮
- 括号包裹 `(这是内容)` → 特殊背景色/高亮
- 其他自定义格式

**实现思路**：
1. 在 Markdown 渲染器中添加自定义插件
2. 创建配置界面让用户定义规则
3. 存储规则到用户偏好设置

---

### 3. CSS 完全自定义工具

**需求描述**：
- 对话界面 CSS 完全自定义
- 添加到设置页面
- 让用户完全控制对话界面的视觉样式

**实现思路**：
1. 创建 CSS 编辑器组件
2. 使用 `<style>` 标签动态注入用户 CSS
3. 提供预设主题模板
4. 添加 CSS 语法验证

---

### 4. 流式计时器

**需求描述**：
- 显示流式响应的耗时
- 实时更新计时

**实现思路**：
1. 在流式响应开始时记录时间
2. 在 UI 中显示实时计时
3. 响应结束后显示总耗时

**工作量**: 0.5-1 天

---

### 5. 思维链可折叠

**需求描述**：
- 默认识别 `<think>` 标签内容为模型思维链
- 用户可设置是否折叠显示
- 可配置自定义思维链标签

**实现思路**：
1. 在 Markdown 渲染器中解析 `<think>` 标签
2. 使用 Collapsible 组件包裹
3. 添加设置项控制默认折叠状态
4. 支持自定义标签名

---

## 中优先级

### 6. 函数调用框架

**需求描述**：
利用模型的函数调用能力实现：
- 计算器
- 天气查询
- 网络搜索
- 等等

**实现位置**: `lib/ai/tools/`

**实现思路**：
1. 创建工具注册表
2. 定义工具接口
3. 在 API 路由中集成函数调用
4. 在 UI 中显示函数调用结果

---

### 7. MCP（Model Context Protocol）集成

**需求描述**：
- 参考 VS Code 扩展管理的样式
- 项目内部可以自由配置 JSON
- 有专门配置 MCP 的页面

**实现思路**：
1. 研究 MCP 规范
2. 创建 MCP 客户端
3. 设计 MCP 配置界面
4. 实现 MCP 工具调用

---

### 8. JavaScript 运行时

**需求描述**：
- 通过 JavaScript 实现模型做不到的功能
- 用户输入触发 JavaScript 执行
- 动态提示词生成

**实现思路**：
1. 使用沙箱环境执行用户 JavaScript
2. 提供 API 供脚本调用（注入提示词等）
3. 创建脚本编辑器界面

**安全考虑**: 需要严格的沙箱隔离

---

### 9. 正则表达式处理

**需求描述**：
- 后处理模型的输出或输入
- 可选功能开关
- 两种模式：
  - 实际修改模式：真正修改内容
  - 视觉效果模式：仅在 UI 层面修改显示

**实现思路**：
1. 创建正则表达式规则管理界面
2. 在消息处理流程中应用规则
3. 区分输入/输出/显示三个处理点

---

### 10. Dev Mode 完善

**当前状态**: 已有基础实现

**待完善**：
- 完整的 debug 消息显示
- 请求体/响应体格式化显示
- 性能指标详细分析
- 日志过滤和搜索

---

## 低优先级

### 11. 迁移到 SQLite

**需求描述**：
- 从 JSON 文件存储迁移到 SQLite
- 提升性能
- 更好的查询能力

**实现思路**：
1. 设计数据库架构
2. 创建迁移脚本
3. 重写存储层
4. 添加索引优化

**当前状态**: JSON 方案工作正常，优先级较低

---

### 12. 单元测试与 E2E 测试

**需求描述**：
- 提示词构建器单元测试
- 数据存储层单元测试
- 关键组件集成测试
- E2E 测试（Playwright）

**目标**: 测试覆盖率 >80%

---

### 13. 完整项目文档

**需要编写**：
- 用户指南
- API 文档
- 提示词编写指南
- 开发指南
- 示例配置文件和角色卡

---

## 实施建议

### 推荐开发顺序

#### 第一批（核心体验）
1. 流式计时器 - 0.5-1 天
2. 思维链可折叠 - 1-2 天
3. 实时变量系统 - 1-2 天

#### 第二批（渲染增强）
1. 特殊字段渲染 - 2-3 天
2. CSS 自定义工具 - 3-5 天

#### 第三批（高级功能）
1. Dev Mode 完善 - 2-3 天
2. 正则表达式处理 - 3-5 天
3. 函数调用框架 - 5-7 天

#### 第四批（扩展能力）
1. MCP 集成 - 7-10 天
2. JavaScript 运行时 - 5-7 天

---

## 总结

| 优先级 | 数量 | 预计工作量 |
|--------|------|------------|
| 高 | 5 项 | 约 8-12 天 |
| 中 | 5 项 | 约 20-30 天 |
| 低 | 3 项 | 约 15-25 天 |
| **总计** | **13 项** | **约 43-67 天** |
