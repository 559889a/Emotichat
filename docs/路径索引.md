# EmotiChat 路径索引

> 快速查找组件和模块文件位置
> 最后更新：2025-11-25

---

## 目录结构概览

```
emotichat/
├── app/                          # Next.js 应用目录
│   ├── (main)/                   # 主应用路由组
│   │   ├── chat/                 # 聊天页面
│   │   ├── characters/           # 角色管理页面
│   │   ├── user-profiles/        # 用户配置页面
│   │   └── settings/             # 设置页面
│   ├── api/                      # API 路由
│   └── layout.tsx                # 根布局
├── components/                   # React 组件
│   ├── ui/                       # 基础UI组件 (shadcn/ui)
│   ├── layout/                   # 布局组件
│   ├── chat/                     # 聊天功能组件
│   ├── character/                # 角色管理组件
│   ├── prompt/                   # 提示词编辑组件
│   ├── preset/                   # 预设相关组件
│   └── settings/                 # 设置组件
├── lib/                          # 核心库文件
│   ├── ai/                       # AI模型系统
│   ├── prompt/                   # 提示词处理系统
│   ├── storage/                  # 数据存储
│   └── utils/                    # 工具函数
├── stores/                       # Zustand 状态管理
├── hooks/                        # 自定义 React Hooks
├── types/                        # TypeScript 类型定义
└── docs/                         # 文档目录
```

---

## 页面路由 (`app/`)

### 主应用页面

| 路径 | 文件 | 功能 |
|------|------|------|
| `/` | `app/page.tsx` | 根页面（重定向） |
| `/chat` | `app/(main)/chat/page.tsx` | 聊天页面 |
| `/characters` | `app/(main)/characters/page.tsx` | 角色列表页面 |
| `/characters/new` | `app/(main)/characters/new/page.tsx` | 新建角色 |
| `/characters/[id]/edit` | `app/(main)/characters/[id]/edit/page.tsx` | 编辑角色 |
| `/user-profiles/new` | `app/(main)/user-profiles/new/page.tsx` | 新建用户配置 |
| `/user-profiles/[id]/edit` | `app/(main)/user-profiles/[id]/edit/page.tsx` | 编辑用户配置 |
| `/settings` | `app/(main)/settings/page.tsx` | 设置页面 |
| `/settings/prompts` | `app/(main)/settings/prompts/page.tsx` | 提示词预设设置 |

### 布局文件

| 文件 | 功能 |
|------|------|
| `app/layout.tsx` | 根布局（主题、字体） |
| `app/(main)/layout.tsx` | 主应用布局（侧边栏、Header） |

---

## API 路由 (`app/api/`)

### 对话相关

| 路由 | 方法 | 功能 |
|------|------|------|
| `/api/conversations` | GET/POST | 对话列表获取/创建 |
| `/api/conversations/[id]` | GET/PUT/DELETE | 单个对话操作 |
| `/api/conversations/[id]/messages` | GET/POST | 消息列表/发送消息 |
| `/api/conversations/[id]/messages/[messageId]` | PUT/DELETE | 单条消息操作 |

### 角色相关

| 路由 | 方法 | 功能 |
|------|------|------|
| `/api/characters` | GET/POST | 角色列表获取/创建 |
| `/api/characters/[id]` | GET/PUT/DELETE | 单个角色操作 |
| `/api/characters/[id]/activate` | POST | 激活角色 |

### 预设相关

| 路由 | 方法 | 功能 |
|------|------|------|
| `/api/presets` | GET/POST | 预设列表获取/创建 |
| `/api/presets/[id]` | PUT/DELETE | 单个预设操作 |
| `/api/presets/active` | GET | 获取当前活跃预设 |

### 其他

| 路由 | 方法 | 功能 |
|------|------|------|
| `/api/chat` | POST | 聊天API（AI对话） |
| `/api/models` | GET | 获取可用模型列表 |

---

## 组件 (`components/`)

### UI 基础组件 (`components/ui/`)

| 文件 | 功能 |
|------|------|
| `button.tsx` | 按钮组件 |
| `input.tsx` | 文本输入框 |
| `textarea.tsx` | 多行文本框 |
| `select.tsx` | 下拉选择框 |
| `slider.tsx` | 滑块组件 |
| `switch.tsx` | 开关组件 |
| `card.tsx` | 卡片容器 |
| `dialog.tsx` | 对话框 |
| `sheet.tsx` | 侧面板 |
| `popover.tsx` | 弹出框 |
| `tabs.tsx` | 标签页 |
| `alert.tsx` | 警告提示 |
| `alert-dialog.tsx` | 警告对话框 |
| `badge.tsx` | 徽章标签 |
| `avatar.tsx` | 用户头像 |
| `scroll-area.tsx` | 滚动区域 |
| `tooltip.tsx` | 工具提示 |
| `dropdown-menu.tsx` | 下拉菜单 |
| `label.tsx` | 标签文本 |
| `collapsible.tsx` | 可折叠面板 |
| `command.tsx` | 命令菜单 |
| `separator.tsx` | 分隔线 |
| `toaster.tsx` | Toast通知容器 |

### 布局组件 (`components/layout/`)

| 文件 | 功能 |
|------|------|
| `sidebar.tsx` | 侧边导航栏 |
| `header.tsx` | 移动端头部 |
| `theme-provider.tsx` | 主题提供者 |
| `theme-toggle.tsx` | 主题切换按钮 |
| `error-boundary.tsx` | 错误边界 |

### 聊天组件 (`components/chat/`)

| 文件 | 功能 |
|------|------|
| `message-list.tsx` | 消息列表容器 |
| `message-bubble.tsx` | 消息气泡 |
| `message-editor.tsx` | 消息编辑器 |
| `message-actions.tsx` | 消息操作栏 |
| `version-selector.tsx` | 版本选择器 |
| `chat-input.tsx` | 聊天输入框 |
| `welcome-screen.tsx` | 欢迎屏幕 |
| `conversation-list.tsx` | 对话列表 |
| `new-conversation-dialog.tsx` | 新建对话对话框 |
| `conversation-settings-dialog.tsx` | 对话设置对话框 |
| `conversation-prompt-config.tsx` | 对话提示词配置 |
| `model-selector.tsx` | 模型选择器 |
| `model-parameters.tsx` | 模型参数配置 |
| `token-counter.tsx` | Token计数器 |
| `markdown-renderer.tsx` | Markdown渲染器 |
| `dev-mode-panel.tsx` | 开发者模式面板 |

### 角色组件 (`components/character/`)

| 文件 | 功能 |
|------|------|
| `character-card.tsx` | 角色卡片 |
| `character-form.tsx` | 角色编辑表单 |
| `prompt-config.tsx` | 角色提示词配置 |

### 提示词组件 (`components/prompt/`)

| 文件 | 功能 |
|------|------|
| `prompt-editor.tsx` | 提示词编辑器 |
| `prompt-item-editor.tsx` | 提示词条编辑 |
| `prompt-preview.tsx` | 提示词预览 |
| `variable-insert-menu.tsx` | 变量插入菜单 |

### 预设组件 (`components/preset/`)

| 文件 | 功能 |
|------|------|
| `preset-prompt-editor.tsx` | 预设提示词编辑器 |

### 设置组件 (`components/settings/`)

| 文件 | 功能 |
|------|------|
| `api-keys.tsx` | API密钥管理 |
| `custom-provider-dialog.tsx` | 自定义提供商对话框 |
| `global-endpoint-selector.tsx` | 全局端点选择器 |
| `preset-editor.tsx` | 预设编辑器 |
| `authors-note-editor.tsx` | 作者笔记编辑器 |
| `scenario-editor.tsx` | 场景编辑器 |

---

## 核心库 (`lib/`)

### 提示词系统 (`lib/prompt/`)

| 文件 | 功能 |
|------|------|
| `builder.ts` | 提示词构建引擎 |
| `variables.ts` | 变量替换 |
| `placeholders.ts` | 占位符处理 |
| `macros.ts` | 宏展开 |
| `role-adapter.ts` | Role适配器（Gemini/OpenAI/Claude） |
| `injection.ts` | 注入处理 |
| `post-processor.ts` | 后处理系统 |
| `index.ts` | 模块导出 |
| `presets/templates.ts` | 预设模板 |

### AI模型系统 (`lib/ai/`)

| 文件 | 功能 |
|------|------|
| `models/index.ts` | 模型导出和工具函数 |
| `models/providers.ts` | 官方提供商配置 |
| `models/custom.ts` | 自定义提供商 |
| `models/types.ts` | 类型定义 |
| `providers/registry.ts` | 提供商注册表 |

### 数据存储 (`lib/storage/`)

| 文件 | 功能 |
|------|------|
| `conversations.ts` | 对话存储 |
| `characters.ts` | 角色存储 |
| `memories.ts` | 记忆存储 |
| `config.ts` | 配置存储 |
| `lock.ts` | 文件锁机制 |

### 工具函数 (`lib/utils/`)

| 文件 | 功能 |
|------|------|
| `token-counter.ts` | Token计数工具 |
| `../utils.ts` | 通用工具函数 |

---

## 状态管理 (`stores/`)

| 文件 | 功能 |
|------|------|
| `conversation.ts` | 对话状态Store |
| `uiPreferences.ts` | UI偏好Store |

---

## 自定义Hooks (`hooks/`)

| 文件 | 功能 |
|------|------|
| `useConversations.ts` | 对话列表Hook |
| `useRecentConversations.ts` | 最近对话Hook |
| `useMessages.ts` | 消息Hook |
| `useCharacters.ts` | 角色Hook |

---

## 类型定义 (`types/`)

| 文件 | 功能 |
|------|------|
| `index.ts` | 类型导出 |
| `conversation.ts` | 对话类型 |
| `character.ts` | 角色类型 |
| `prompt.ts` | 提示词类型 |
| `dev-mode.ts` | 开发者模式类型 |

---

## 快速查找指南

### 按功能查找

**聊天功能**
- 发送消息：`components/chat/chat-input.tsx`
- 显示消息：`components/chat/message-list.tsx` + `message-bubble.tsx`
- 编辑消息：`components/chat/message-editor.tsx`
- AI对话API：`app/api/chat/route.ts`

**角色管理**
- 角色列表：`app/(main)/characters/page.tsx`
- 角色卡片：`components/character/character-card.tsx`
- 角色表单：`components/character/character-form.tsx`

**提示词系统**
- 构建引擎：`lib/prompt/builder.ts`
- 变量/宏处理：`lib/prompt/variables.ts` + `macros.ts`
- Role适配：`lib/prompt/role-adapter.ts`

**模型配置**
- 模型选择：`components/chat/model-selector.tsx`
- 模型参数：`components/chat/model-parameters.tsx`
- API密钥：`components/settings/api-keys.tsx`

**调试工具**
- 开发者面板：`components/chat/dev-mode-panel.tsx`
- Token计数：`components/chat/token-counter.tsx`
